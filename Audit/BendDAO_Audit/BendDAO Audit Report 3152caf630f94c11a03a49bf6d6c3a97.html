<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>BendDAO Audit Report</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="cf35568b-4314-4e14-a2ab-eb3d48f0ea2c" class="page sans"><header><h1 class="page-title">BendDAO Audit Report</h1><table class="properties"><tbody></tbody></table></header><div class="page-body"><blockquote id="5230579d-d19d-45c1-a7e7-2d04e56f96e9" class="block-color-gray"><mark class="highlight-gray">Copyright © 2022 by Verilog Solutions. All rights reserved.</mark><p id="653e5d1d-fdc5-4190-90d6-cefdacecb4d2" class=""><mark class="highlight-gray">May 24, 2022</mark></p><p id="39ac14cb-3827-4407-91bc-ec814b44ebb8" class=""><mark class="highlight-gray">by </mark><mark class="highlight-gray"><strong>Verilog Solutions</strong></mark></p></blockquote><p id="71b04826-14a9-4716-8a6c-926c1d3e585c" class="">This report presents our engineering engagement with the BendDAO team on their decentralized non-custodial NFT liquidity and lending protocol – the BendDAO Protocol.</p><table id="d5a8c801-0640-478b-9665-7ca6ab71848f" class="simple-table"><tbody><tr id="9cf271c2-e3fe-418d-9b5d-13a84947f20b"><th id="Mp:c" class="block-color-default simple-table-header" style="width:186px">Project Name</th><td id="h@it" class="" style="width:361px">Bend Protocol</td></tr><tr id="cc031e01-f09c-4020-82ee-f529b74176e3"><th id="Mp:c" class="block-color-default simple-table-header" style="width:186px">Repository Link</th><td id="h@it" class="" style="width:361px"><a href="https://github.com/BendDAO/bend-lending-protocol">https://github.com/BendDAO/bend-lending-protocol</a></td></tr><tr id="618a6efc-3207-4683-8381-c4ccae779854"><th id="Mp:c" class="block-color-default simple-table-header" style="width:186px">Commit Hash</th><td id="h@it" class="" style="width:361px"><a href="https://github.com/BendDAO/bend-protocol/tree/087c284fda18e9d7fd3a07de384a2245d5eab6ea"><strong>087c284fda18e9d7fd3a07de384a2245d5eab6ea</strong></a></td></tr><tr id="7215bf46-1a26-42e9-967e-4850ea165acb"><th id="Mp:c" class="block-color-default simple-table-header" style="width:186px">Language </th><td id="h@it" class="" style="width:361px">Solidity</td></tr><tr id="1a431d43-92fe-4320-85af-796069128693"><th id="Mp:c" class="block-color-default simple-table-header" style="width:186px">Chain</th><td id="h@it" class="" style="width:361px">Ethereum</td></tr></tbody></table><figure id="3152caf6-30f9-4c11-a03a-49bf6d6c3a97" class="image"><a href="BendDAO%20Audit%20Report%203152caf630f94c11a03a49bf6d6c3a97/Untitled.png"><img style="width:1920px" src="BendDAO%20Audit%20Report%203152caf630f94c11a03a49bf6d6c3a97/Untitled.png"/></a></figure><h2 id="90dfdaa9-eb05-4c99-9041-f592946f266a" class=""><details open=""><summary>About Verilog Solutions</summary></details></h2><div class="indented"><p id="ae01a4b3-b7ad-415d-8744-7f67ce713674" class="">Founded by a group of cryptography researchers and smart contract engineers in North America, Verilog Solutions elevates the security standard for Web3 ecosystems by being a full-stack Web3 security firm covering smart contract security, consensus security, and operational security for Web3 projects.</p><p id="bca48516-1555-4d84-ae9a-4e828bdf7204" class="">Verilog Solutions team works closely with major ecosystems and Web3 projects and applies a quality above quantity approach with a continuous security model. Verilog Solutions onboards the best and most innovative projects and provides the best-in-class advisory service on security needs, including on-chain and off-chain components.</p></div><h2 id="82aad9b8-68c6-4904-bee5-71001751cee5" class=""><details open=""><summary>Table of Contents</summary></details></h2><div class="indented"><nav id="834c8dad-39a5-413e-95e9-4ce52edfdbdc" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#90dfdaa9-eb05-4c99-9041-f592946f266a">About Verilog Solutions</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#82aad9b8-68c6-4904-bee5-71001751cee5">Table of Contents</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a7aceccf-1ae1-4790-8e41-c6b5f173712d">Service Scope</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#19299ffc-7368-4f74-97c2-186ad7a4e47b">Project Summary</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#33b60193-ae3a-45ac-be4c-b871b48042d5"><strong><strong>Findings &amp; Improvement Suggestions</strong></strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#142b159f-f21b-4548-9fa6-b5a155b00405">Access Control Analysis</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#c9e70809-9624-43ac-bbc9-71ba185117c5">Off-Chain OpSec</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#68648cff-cb6f-41c6-a5a2-4c9cf65b4cea">Appendix I: Severity Categories</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1fca1f6c-db85-4a54-961f-9f0bacc997dc">Appendix II: Status Categories</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#52e27793-a0e0-40a8-a5ee-72e6e0f11975">Disclaimer</a></div></nav></div><h2 id="a7aceccf-1ae1-4790-8e41-c6b5f173712d" class=""><details open=""><summary>Service Scope</summary></details></h2><div class="indented"><h3 id="ea220dd3-f83a-454a-bfbb-517cd0a7152f" class=""><details open=""><summary>Service Stages </summary></details></h3><div class="indented"><p id="a8d3555d-0c28-47a3-a68e-8ffca097b126" class="">Our auditing service includes the following two stages:</p><ul id="bb008db2-80e9-4675-9742-8ef4f712851b" class="bulleted-list"><li style="list-style-type:disc">Pre-Audit Consulting Service</li></ul><ul id="8141c686-75a2-4298-a7a4-f9c70f76dd8d" class="bulleted-list"><li style="list-style-type:disc">Smart Contract Auditing Service</li></ul><ol type="1" id="a94a0d6c-460b-4070-9b6e-8c4aa1182ed1" class="numbered-list" start="1"><li><strong>Pre-Audit Consulting Service</strong><ul id="7a2f0e53-1a39-4ed8-b4a9-7b8f71c3bd2c" class="bulleted-list"><li style="list-style-type:disc">[Price Oracle Design Discussion Meeting]<p id="c6c78ccd-df19-47ee-a08a-d5694be5c4c1" class="">The Verilog Solutions team discussed with the BendDAO team regarding its collateral price oracle design. Throughout the discussion, the Verilog Solutions team conducted a review of the current oracle design and provided feedback and suggestions to the BendDAO team. It is acknowledged by both teams that the price oracle should be as simple as possible to ensure the reliability of data and reduce the attack surface.</p></li></ul><ul id="598f02e2-398b-41b5-88bc-9cff018567b3" class="bulleted-list"><li style="list-style-type:disc">[Protocol Security &amp; Design Discussion Meeting]<p id="468f1ca3-cf01-4312-8c4a-b72faec9a111" class="">The Verilog Solutions team discussed with the BendDAO team about off-chain component executions and the security best practice for securing the off-chain components. Verilog Solutions team also provided feedback and suggestions on how to ensure reliability for mission-critical off-chain components including the price oracle service and monitoring.</p></li></ul></li></ol><ol type="1" id="7d12bae5-3820-47e3-b297-f4c0eb656594" class="numbered-list" start="2"><li><strong>Smart Contract Auditing Service</strong><p id="7e50d9fc-e76b-439f-875a-a4442c68c9e9" class="">The Verilog Solutions team analyzed the entire project using a detailed-oriented approach to capture the fundamental logic and suggested improvements to the existing code. Details can be found under <strong>Findings &amp; Improvement Suggestions</strong>.</p></li></ol></div><h3 id="5a2b7e10-460f-4f35-9530-5b65a1685bea" class=""><details open=""><summary>Audit Scope</summary></details></h3><div class="indented"><p id="0df7c71f-71ba-4154-abd5-5d4d43ca4d4b" class="">Our auditing for BendDAO covered the repository:</p><ul id="b6bb362c-c2a5-4c4e-b2a4-4d336066d192" class="bulleted-list"><li style="list-style-type:disc"><a href="https://github.com/BendDAO/bend-lending-protocol">https://github.com/BendDAO/bend-lending-protocol</a> : commit hash <a href="https://github.com/BendDAO/bend-lending-protocol/tree/087c284fda18e9d7fd3a07de384a2245d5eab6ea"><strong>087c284fda18e9d7fd3a07de384a2245d5eab6ea</strong></a><p id="5bc22c0a-253d-4d90-b902-5841d8cc873c" class="">contains the smart contracts source code and markets configuration for Bend Protocol.</p></li></ul></div></div><h2 id="19299ffc-7368-4f74-97c2-186ad7a4e47b" class=""><details open=""><summary>Project Summary</summary></details></h2><div class="indented"><p id="48651a63-3497-4783-b490-7ad548add578" class="">BendDAO is a decentralized peer-to-pool-based NFT liquidity protocol. Depositors provide ETH liquidity to the lending pool to earn interest, while borrowers can borrow ETH from the lending pool using NFTs as collateral.</p><p id="f8ba1ccd-01d0-4ee4-a9f9-bffe39e1135f" class="">The BendDAO protocol enables NFT assets to be deposited and converted into ERC721 boundNFTs, which can be used to create NFT loans.</p><p id="c7b534fb-a8a9-40e9-be76-904fe6a22703" class="">
</p><figure id="75fd77b5-b5ef-455f-9994-55c35c3ee180" class="image"><a href="BendDAO%20Audit%20Report%203152caf630f94c11a03a49bf6d6c3a97/Untitled%201.png"><img style="width:713px" src="BendDAO%20Audit%20Report%203152caf630f94c11a03a49bf6d6c3a97/Untitled%201.png"/></a><figcaption>                                              <strong><em>BendDAO Architecture</em></strong></figcaption></figure><p id="d3fe79f9-0e64-4de9-8011-aa410d983f18" class="">
</p><p id="e508b0af-376a-4659-8ff0-44b3fa4331e9" class=""><strong>BendDAO protocol contains three major parts:</strong></p><ul id="d66dfd90-ae77-4639-8ebf-be2b200c30d4" class="bulleted-list"><li style="list-style-type:disc"><a href="https://www.notion.so/BendDAO-Audit-Report-cf35568b43144e14a2abeb3d48f0ea2c">Lending Protocol</a></li></ul><ul id="29abf52e-0f88-4aa1-86e6-1c16ffb1219b" class="bulleted-list"><li style="list-style-type:disc"><a href="https://www.notion.so/BendDAO-Audit-Report-cf35568b43144e14a2abeb3d48f0ea2c">NFT Oracle</a></li></ul><ul id="aad477d0-c65f-41a7-8579-0267c2e89512" class="bulleted-list"><li style="list-style-type:disc"><a href="https://www.notion.so/BendDAO-Audit-Report-cf35568b43144e14a2abeb3d48f0ea2c">Bound NFT</a></li></ul><h3 id="a72e2743-079f-4a66-acb7-aa66540f0e77" class=""><details open=""><summary>Lending Protocol</summary></details></h3><div class="indented"><blockquote id="028dbae6-a233-4d25-bf69-4a822c89235f" class=""><mark class="highlight-gray">contains the smart contracts source code and markets configuration for Bend Protocol.</mark></blockquote><p id="3c490392-727c-426e-8937-0a4520ae0d9f" class=""><code>LendPool.sol</code>: It is the main entry point into the BendDAO Protocol. Most interactions with the BendDAO Protocol happen via the <code>LendPool.sol</code>. Users can either deposit supported assets to earn interest or deposit supported NFTs to borrow reserve assets.
</p><p id="956efa62-c7d5-406c-a959-5cadb51b211d" class=""><code>LendPoolLiquidator.sol</code>: It contains the main logic of the auction and liquidation functions. <code>LendPool.sol</code> delegates calls to <code>LendPoolLiquidator.sol</code> for <code>auction()</code>, <code>redeem()</code> and <code>liquidate()</code>.
</p><p id="81ce6fc1-be83-4c57-9ea1-0fbc1b51b5ac" class=""><code>LendPoolLoan.sol</code>: It is the NFT loan manager of the protocol, which generates a unique loan when NFTs are used as collateral in borrowing, and maintains the relationship between the NFT and the loan.
</p><p id="fbcdde5b-661e-428b-8b16-f893b04151ad" class=""><code>BToken.sol</code>: The BToken is an interest-bearing transferrable token minted and burned upon a deposit and withdrawal. The value of BToken is pegged to the value of the corresponding deposited asset at a 1:1 ratio.
</p><p id="8aa85b8e-c561-42e2-927b-142cd64386d8" class=""><code>DebtToken.sol</code>: The Debt Token is an interest-accruing non-transferrable token minted and burned on borrow and repay. It represents debts owed by a token holder.</p></div><h3 id="91344384-f106-4777-b640-31b1fa305f7d" class=""><details open=""><summary>NFT Oracle</summary></details></h3><div class="indented"><blockquote id="a6e49e43-d216-43f5-b878-676819f2c384" class=""><mark class="highlight-gray">contains the smart contract source code to provide lending protocol with a market valuation of the underlying asset.</mark></blockquote><p id="c170e07e-f634-4209-8ab1-9cf5181845ef" class="">The BendDAO team designed a filter algorithm to fetch the floor price data from OpenSea and LooksRare. </p><ol type="1" id="fd6f1a38-a013-40ca-a06d-d4fa35186e8f" class="numbered-list" start="1"><li>The NFT Oracle is currently maintained and operated by the BendDAO team. The data fetching and filtering algorithm scripts are running off-chain.</li></ol><ol type="1" id="6d150684-7434-4f85-b24f-9346714f968c" class="numbered-list" start="2"><li>In the future, the Bend governance mechanisms will manage the selection of data sources.</li></ol></div><h3 id="7b894029-d652-459e-8bb4-1d57321a7ac3" class=""><details open=""><summary>Bound NFT</summary></details></h3><div class="indented"><blockquote id="f2458387-8728-49f2-84c6-a2f01495b36c" class=""><mark class="highlight-gray">BoundNFTs are promissory-note tokens that are minted and burned upon borrowing and repaying, representing the NFT used as collateral owed by the token holder, with the same token ID and metadata. It has a flash claim feature for users to claim airdrops for NFT holders.</mark></blockquote><p id="320bcb76-8885-4a18-b323-8e867e329984" class="">There are two admin roles in <code>BNFT</code> contracts:</p><ul id="67917a08-ee47-4842-9933-ad9e34b52ade" class="bulleted-list"><li style="list-style-type:disc"><code>_owner</code>: handles ownership and admin.</li></ul><ul id="50a1b476-31ca-4f05-8717-c2f5da0a3880" class="bulleted-list"><li style="list-style-type:disc"><code>_claimAdmin</code>: claims and executes ERC20/ERC721/ERC1155 airdrops.</li></ul></div><h3 id="7efd27f5-1cbb-42b1-8068-f4b45284352a" class=""><details open=""><summary><strong><strong>Periphery Contracts</strong></strong></summary></details></h3><div class="indented"><p id="f68b3c17-e605-4da7-aa77-fe49dd7ef1f7" class="">BendDAO protocol also has periphery contracts such as <code>WETHGateway.sol</code> and <code>PunkGateway.sol</code>:</p><ul id="1a0997c9-3b6c-4ff3-bb3f-c29eacda6217" class="bulleted-list"><li style="list-style-type:disc"><code>WETHGateway.sol</code>: <code>LendPool</code> only supports ERC20 tokens as underlying reserve assets. <code>WETHGateway.sol</code> provides an interface that allows users to deposit native tokens such as ETH directly without the need to swap between the native token and the wrapped native token themselves.</li></ul><ul id="a92f9167-6ce4-4262-a5e0-81ef32438dab" class="bulleted-list"><li style="list-style-type:disc"><code>PunkGateway.sol</code>: Lending pool only supports interactions with the standard ERC721 token. NFT CryptoPunks is not ERC721 compatible. <code>PunkGateway</code> helps users to wrap and unwrap CryptoPunks and interact with lend pool.</li></ul></div></div><h2 id="33b60193-ae3a-45ac-be4c-b871b48042d5" class=""><details open=""><summary><strong><strong>Findings &amp; Improvement Suggestions</strong></strong></summary></details></h2><div class="indented"><table id="f27364b4-7823-44de-927c-c5eb6a8f94c9" class="simple-table"><tbody><tr id="bf17c251-af42-4040-a289-8faaaf20fa8b"><td id="G&gt;ax" class="" style="width:120px">Severity</td><td id="T&lt;wm" class=""><strong>Total</strong></td><td id="@mfj" class=""><strong>Acknowledged</strong></td><td id="|V?N" class=""><strong>Resolved</strong></td></tr><tr id="9610b9dd-2ee8-4861-82a5-64d8b8d9a7eb"><td id="G&gt;ax" class="" style="width:120px"><mark class="highlight-red"><strong>High</strong></mark></td><td id="T&lt;wm" class="">0</td><td id="@mfj" class="">0</td><td id="|V?N" class="">0</td></tr><tr id="2d1ffece-93aa-46d2-911b-409bf44e1b84"><td id="G&gt;ax" class="" style="width:120px"><strong><mark class="highlight-orange">Medium</mark></strong></td><td id="T&lt;wm" class="">1</td><td id="@mfj" class="">1</td><td id="|V?N" class="">1</td></tr><tr id="bbf45f2a-93ef-4180-aad7-0ea81dc571ab"><td id="G&gt;ax" class="" style="width:120px"><mark class="highlight-teal"><strong>Low</strong></mark></td><td id="T&lt;wm" class="">4</td><td id="@mfj" class="">4</td><td id="|V?N" class="">1</td></tr><tr id="60ce8889-d896-4bed-8f75-22a662946ed1"><td id="G&gt;ax" class="" style="width:120px"><mark class="highlight-blue"><strong>Informational</strong></mark></td><td id="T&lt;wm" class="">7</td><td id="@mfj" class="">7</td><td id="|V?N" class="">2</td></tr></tbody></table><h3 id="6935be6d-7cda-4d74-a30f-8a9fe5eeb2f7" class=""><details open=""><summary><mark class="highlight-red">High</mark></summary></details></h3><div class="indented"><p id="c5bc7737-fc25-4025-9ea9-9f8409309a6d" class="">none ; )</p></div><h3 id="144cfd21-a9a5-44c4-a6bb-00bc2405e563" class=""><details open=""><summary><mark class="highlight-orange">Medium</mark></summary></details></h3><div class="indented"><ol type="1" id="3642157b-775b-44d2-ba61-c9b501201447" class="numbered-list" start="1"><li><strong><code>LendPool.sol</code></strong><strong> : time elapsed in the PAUSE state needs to be deducted in Redeem and Auction functions</strong><table id="a7b983c0-79bb-48f3-a22f-28e1213d04d7" class="simple-table"><tbody><tr id="e3ece05c-6c93-42c8-9379-a3b341b1608b"><th id="okEA" class="block-color-orange_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-orange_background" style="width:528px"><strong><mark class="highlight-orange">Medium</mark></strong></td></tr><tr id="da6d0e2c-c680-4355-ad5f-8574598d74ae"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px">contracts/protocol/LendPool.sol: <a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/LendPool.sol#L408">#L408 </a>                                                             contracts/protocol/LendPool.sol: <a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/LendPool.sol#L431">#L431</a></td></tr><tr id="f369be01-0f3f-411a-b0fa-58cca4bdd63a"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Resolved</strong> in commit <a href="https://github.com/BendDAO/bend-protocol/commit/64b7861e48cf0156d5f203e3a39166f22ae36dd0">64b7861e48cf0156d5f203e3a39166f22ae36dd0</a></td></tr></tbody></table><ul id="806bf105-dab7-4454-aa21-67171a165e22" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="78ec2706-dc78-43a3-b7ac-78dd07597b80" class="">Time-sensitive functions such as redeem and auction do not deduct time elapsed in the paused state. </p><p id="69d5cc90-d153-4b27-9373-ee0cbb2636b3" class="">If an auction starts and then the protocol enters into a pause state, the time elapsed during the pause period is still counted in time-sensitive functions such as <code>auction</code> and <code>redeem</code>. </p><p id="e5372c67-d030-45f5-a9a8-eac69e9820ef" class="">As a result, any time elapsed in the pause state will erode into the 48-hour grace period of the <code>auction</code> state. Bidders will have a shorter time window to bid. The borrower will have a shorter time window to redeem.</p></details></li></ul><ul id="fc783dd3-57c3-4a2e-87f9-df90da11c091" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="1b4cb664-4100-43d3-a6c1-38d8069d2b14" class="">There are 2 conditions that need to be fulfilled:</p><ol type="1" id="19af0034-bea2-4664-835d-3f59a749b854" class="numbered-list" start="1"><li>there is an undergoing auction</li></ol><ol type="1" id="085ee2d0-5c8d-4007-bd93-ba7a562e8765" class="numbered-list" start="2"><li>the project team triggered the pause function and put the protocol into a pause state</li></ol><p id="cc57c894-0952-46df-8851-ae48817aa25c" class="">As a result, any time elapsed in the pause state will erode into the 48-hour grace period of the <code>auction</code> state. This may result in:</p><ol type="1" id="9e2374b5-ec0c-4c79-a930-8fb69240eb94" class="numbered-list" start="1"><li>Bidders will have a shorter window to bid</li></ol><ol type="1" id="8f6e11d8-4440-4f7f-8600-2590af6b2a13" class="numbered-list" start="2"><li>Borrowers will have a shorter window to redeem</li></ol></details></li></ul><ul id="058250ef-16d5-4574-9f7e-08bb9ba640ad" class="toggle"><li><details open=""><summary><strong>Recommendations</strong></summary><p id="5722212a-1b2a-43d4-8cd8-e78d37b8103a" class="">After <code>unpause</code>, the protocol needs to calculate the duration of the paused period and update <code>auction</code> timestamp to reflect the time elapsed in the paused state.</p></details></li></ul><ul id="9904e6b7-5656-47b8-bbc2-a5d552fefb9c" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="21ff8dd7-124e-44c6-8431-5a9d702876bd" class="">Pause/unpause is rarely executed unless there is an emergency situation. Resolved in commit <a href="https://github.com/BendDAO/bend-protocol/commit/64b7861e48cf0156d5f203e3a39166f22ae36dd0">64b7861e48cf0156d5f203e3a39166f22ae36dd0</a>.</p></details></li></ul></li></ol></div><h3 id="2423ff03-ede8-4679-9e53-b484d47cae9a" class=""><details open=""><summary><mark class="highlight-teal">Low</mark></summary></details></h3><div class="indented"><ol type="1" id="e01e5aab-67f1-4865-8a73-8c2d785adc0c" class="numbered-list" start="1"><li><strong>Unnecessary Require and Redundant Parameter</strong><table id="643ff8a6-101a-435b-9e55-2e1f32b4a5bf" class="simple-table"><tbody><tr id="27a27d9f-74c3-4847-9cf3-08c39c786af8"><th id="okEA" class="block-color-teal_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-teal_background" style="width:528px"><mark class="highlight-teal"><strong>Low</strong></mark></td></tr><tr id="70851573-aafa-4efd-b192-2e6ebfa8509b"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px"><a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/LendPoolLiquidator.sol">contracts/protocol/LendPoolLiquidator.sol</a></td></tr><tr id="3470ea7f-6294-44cb-9dfe-df724edb6570"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Acknowledged</strong></td></tr></tbody></table><ul id="288f8c5e-3c8c-4f9d-886d-1b72089917bd" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="a1bb681c-c861-4ee5-9d27-22b3eaadd86d" class="">In <code>LendPoolLiquidator.sol</code>, there is an unnecessary <code>require</code> in <code>redeem()</code> function and redundant parameter <code>bidFine</code>.</p><pre id="09599b10-8889-4536-968c-22a3a5f2b9f3" class="code"><code>require(vars.bidFine &lt;= bidFine, Errors.LPL_BID_INVALID_BID_FINE); </code></pre><p id="500e5608-3d33-4825-99f9-8d5e9ff1b22c" class=""><code>bidFine</code> is an input supplied by the user, while <code>vars.bidFine</code> is a variable calculated from the contract’s internal states. <code>vars.bidFine</code> is actually referenced in other places, while <code>bidFine</code> is unused anywhere except this requirement check. Therefore, this requirement check is unnecessary, as the input variable being checked <code>bidFine</code> is not used anywhere in other places. The consequence of having this unnecessary requirement check is that if the user inputs a <code>bidFine</code> that is smaller than <code>vars.bidFine</code>, the function call will revert, meanwhile, the incorrect <code>bidFine</code> would not have an effect anywhere, as <code>bidFine</code> is not used anywhere else except this require a check.</p><p id="d66132c6-ae77-4711-a64a-caab79b1f1a3" class="">
</p><pre id="55e0122a-a8f4-448a-9c73-e552423beb7a" class="code"><code>require(vars.repayAmount &lt;= vars.maxRepayAmount, Errors.LP_AMOUNT_GREATER_THAN_MAX_REPAY);</code></pre><p id="7c195f1f-62ce-46ff-b95b-146637e0549b" class="">The current design will cause a revert in the cases where the user input <code>amount</code> is bigger than the <code>maxRepayAmount</code>. Thus the front end is responsible for calculating the correct <code>amount</code> used in the function call. If the users are constructing the transaction themselves (i.e. in case of front-end downtime), the users must calculate the correct <code>amount</code>, otherwise, the transaction will fail. As an alternative design that can improve user experience, the function can just assign the <code>repayAmount</code> with the <code>maxRepayAmount</code> if the <code>amount</code> that the user inputs are bigger than the <code>maxRepayAmount</code>.</p></details></li></ul><ul id="41b0a1ce-80d1-4378-aa3b-b6316db530b0" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="caea122d-1e53-4c9f-92d6-22698bd88ff9" class="">N/A</p></details></li></ul><ul id="e09bd1b0-8fc3-4801-9c50-31b19ad8cab1" class="toggle"><li><details open=""><summary><strong>Recommendation</strong></summary><p id="cabe71d0-aaf8-4a5d-8248-f1504e5f0a3a" class="">Remove these two <code>require</code> and assign the <code>repayAmount</code>with the <code>maxRepayAmount</code>if the <code>amount</code> the user inputs is bigger than the <code>maxRepayAmount</code>.</p></details></li></ul><ul id="35b622ce-3252-44a7-80ab-7e9f12305bde" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="6cb910e5-967e-492f-ab1a-fb87c9dbb485" class=""><strong>Acknowledged</strong>. The BendDAO team decided to keep this design.</p></details></li></ul></li></ol><p id="7b16b8bb-27b8-48dd-8446-009c05ccf9d0" class="">
</p><ol type="1" id="a537aa8b-7dd7-455e-b0d6-274fd81284e4" class="numbered-list" start="2"><li><strong>Unused State in </strong><code>LoanState</code><strong> Enumerator</strong><table id="8fd8c133-20b8-4989-8398-6eeb6816de2b" class="simple-table"><tbody><tr id="7ebf977e-f498-4879-b7e2-d665f86257a4"><th id="okEA" class="block-color-teal_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-teal_background" style="width:528px"><mark class="highlight-teal"><strong>Low</strong></mark></td></tr><tr id="c0d9a131-bae0-4582-bc24-a4824b1740c8"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px"><a href="https://github.com/BendDAO/bend-lending-protocol/blob/main/contracts/libraries/types/DataTypes.sol">contracts/libraries/types/DataTypes.sol</a></td></tr><tr id="8a0b881f-5c29-4b0c-9342-f1763b2f70d8"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Acknowledged</strong></td></tr></tbody></table><ul id="994a0ad2-0e37-44b4-a893-de4834602143" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="f31b84b7-2238-4bf5-a1d1-e6a2d97acd86" class=""><code>LoanState</code> enumerator in <code>DataTypes.sol</code> has a state variable <code>Created</code> which has never been used across the entire repository. </p><p id="bef69bae-7705-481d-8801-703075eec8c1" class=""><code>DataTypes.sol</code> stored all the pre-defined configuration-related data struct and enumerator. <code>LoanState</code> enumerator defines the current state of a loan.  There are in total 6 pre-defined states:</p><ol type="1" id="44725e54-4b8e-4a55-92d3-08facaee9bf4" class="numbered-list" start="1"><li><code>None</code> - default value, this means zero value in loan</li></ol><ol type="1" id="334365e6-1b0f-479d-8a48-de03e378611a" class="numbered-list" start="2"><li><code>Created</code> - Loan data has been stored, but not initiated yet</li></ol><ol type="1" id="16c9cc21-a312-4d77-a271-fe38d003349e" class="numbered-list" start="3"><li><code>Active</code> - The loan has been initialized, funds have been delivered to the borrower and the collateral is held</li></ol><ol type="1" id="d647159e-8155-4ca5-bbee-3c9fd2bd0cdb" class="numbered-list" start="4"><li><code>Auction</code> - The loan is in the auction, and the highest price liquidator will get a chance to claim it.</li></ol><ol type="1" id="ef40b2fd-e3a4-4171-ad25-7a18da06a5c3" class="numbered-list" start="5"><li><code>Repaid</code> - The loan has been repaid, and the collateral has been returned to the borrower. This is a terminal state.</li></ol><ol type="1" id="770cd7d5-e39b-4c3d-98b4-3bc20ac8a890" class="numbered-list" start="6"><li><code>Defaulted</code> - The loan was delinquent and collateral was claimed by the liquidator. This is a terminal state.</li></ol><p id="30aa215f-1d5e-47b0-911a-1a58273b4145" class="">However, <code>LoanState.Created</code> has never been used. <code>LoanState</code>is changed to <code>Active </code>after <code>createLoan()</code>. Having unused states might become confusing for subsequent development work.</p></details></li></ul><ul id="95bf13e8-6a9a-4653-9c3c-ca42344b6499" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="1c829eb9-8627-4ca0-89dd-d29563f2a859" class="">N/A</p></details></li></ul><ul id="05503474-2840-425b-a620-d151cf292298" class="toggle"><li><details open=""><summary><strong>Recommendation</strong></summary><p id="5f44b0cf-9f5d-48b6-bee8-5f56b6d4f89e" class="">Remove the unused state.</p></details></li></ul><ul id="dc87b2e1-a573-4088-a9f4-f4de15aad753" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="f3a207b2-d1a0-4ccd-8616-e906c21edfbb" class=""><strong>Acknowledged. </strong>It’s from the previous code design. The BendDAO team decided to keep this design.</p></details></li></ul></li></ol><p id="b16274a2-9083-4ef4-8bc0-0e6eeb141cc3" class="">
</p><ol type="1" id="2e567956-a3e3-4d6a-9bc7-61ad60ad1054" class="numbered-list" start="3"><li><strong>Redundant Parameter</strong><table id="9353340c-edd6-4cc7-b246-79182eddb188" class="simple-table"><tbody><tr id="6065bdeb-858c-42a5-bf2f-28bdf7a5e213"><th id="okEA" class="block-color-teal_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-teal_background" style="width:528px"><mark class="highlight-teal"><strong>Low</strong></mark></td></tr><tr id="6d8d69f7-d64c-4c38-8ac9-a71c786ccae8"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px">contracts/protocol/LendPoolLiquidator.sol:<a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/LendPoolLiquidator.sol#L286"> L286</a></td></tr><tr id="76c844ee-f418-4f8b-9d3b-71d212f2256d"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Acknowledged</strong></td></tr></tbody></table><ul id="493ea8fa-00c8-4a66-a8c8-f53e239fa799" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="4321f2b7-a3d3-4cb3-914d-3063cb444621" class="">In <code>LendPoolLiquidator.sol</code>, the function <code>liquidate()</code> has an input parameter called <code>amount</code>, which is redundant and can be easily bypassed.</p><p id="db222a9d-357a-4905-8a42-c529b2d6b82a" class="">Function <code>liquidate()</code> in <code>LendPoolLiquidator.sol</code> can be called to liquidate a non-healthy position. The function caller (liquidator) buys the collateral asset from the user that is liquidated and receives the collateral asset. There are 3 parameters that the caller needs to pass in, but only the first two are necessary:</p><ol type="1" id="8b7262a5-b508-4658-84b1-4726c8a1ee78" class="numbered-list" start="1"><li><code>nftAsset</code> - The address of the underlying NFT used as collateral</li></ol><ol type="1" id="4417e593-d4b6-47d5-846b-88e74fd82eba" class="numbered-list" start="2"><li><code>nftTokenId</code> -  The token ID of the underlying NFT used as collateral</li></ol><ol type="1" id="fbdefdf8-215e-4727-8370-a206b51a6ce6" class="numbered-list" start="3"><li><code>amount</code> - The amount of ETH to be paid by the liquidator</li></ol><p id="e4654f87-f8dc-4e6d-9b07-9ef694dd932f" class="">However, the function input parameter <code>amount</code> is only referenced in the require statement. The actual amount that the liquidator needs to pay is calculated internally in the <code>liquidate()</code> function.</p><p id="e7684526-5a63-4269-bf5f-963cb090156c" class="">Therefore, this requirement check is unnecessary, as the input variable being checked <code>amount</code> is not used anywhere in other places. The consequence of having this unnecessary requirement check is that if the user inputs an <code>amount</code> that is greater than <code>vars.extraDebtAmount</code>, the function call will revert, meanwhile, the incorrect <code>amount</code> would not have an effect anywhere, as <code>amount</code> is not used anywhere else except this require a check.</p><p id="e2bacba5-6ae8-4426-906d-201606f4431f" class="">The front end is responsible for calculating the correct <code>amount</code> used in the function call. If the users are constructing the transaction themselves (i.e. in case of front-end downtime), the users must calculate the correct <code>amount</code>, otherwise, the transaction will fail. </p></details></li></ul><ul id="957d3bc5-9b04-4791-b729-70dc58c0d8a6" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="d618ea90-351f-4093-8573-73963becdad9" class="">N/A</p></details></li></ul><ul id="b89d5312-a716-4105-8891-37859173f8d8" class="toggle"><li><details open=""><summary><strong>Recommendation</strong></summary><p id="be48a05b-c02e-4a40-8ecc-54f56985ce22" class="">Parameter <code>amount</code> in function <code>liquidate()</code> can be removed.</p></details></li></ul><ul id="c2c08679-f8ba-4329-8f4a-baa1522b6f92" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="12d5e9ea-67fd-4b6e-9ff7-1757cc9b800a" class=""><strong>Acknowledged. </strong>This parameter is mainly for the <code>WETHGateWay.sol</code> contract, checking the <code>msg.value</code> passing from the gateway contract to the main lend pool contract. The BendDAO team decided to keep this design.</p></details></li></ul><p id="2a86a565-328e-43e7-bacd-4b97c7506249" class="">
</p></li></ol><ol type="1" id="5a2d1b84-22ad-4d8b-b43b-4c546bcc42ba" class="numbered-list" start="4"><li><strong>Function </strong><strong><code>executeOperation()</code></strong><strong>uses a method from non-standard EIP721</strong><table id="98389151-ca73-4c89-8fc3-d179b1eff6c3" class="simple-table"><tbody><tr id="1f82fa13-0b9c-4170-a8ee-e67397fa8e2d"><th id="okEA" class="block-color-teal_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-teal_background" style="width:528px"><mark class="highlight-teal"><strong>Low</strong></mark></td></tr><tr id="ad2e53ae-21f2-4d53-97ae-80cdc6c6feb9"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px">boundnft-protocol/contracts.misc/AirdropFlashLoanReceiver.sol:<a href="https://github.com/BoundNFT/boundnft-protocol/blob/cb3418b681390439f6c206166ce24d55352bf1ab/contracts/misc/AirdropFlashLoanReceiver.sol#L106"> L106</a></td></tr><tr id="4f854588-b389-48de-af2e-c7716f7395a1"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Resolved</strong></td></tr></tbody></table><ul id="2cd1e2f4-d7e3-4ec0-885f-f63048f4e7ff" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="815bd7c0-1be8-4417-a7bf-b917a17ba2f4" class="">Function <code>executeOperation()</code>uses <code>IERC721Enumerable(token).tokenOfOwnerByIndex()</code>, which is not supported by standard EIP721. </p><p id="afe61ef6-11c6-4394-ba12-c3ce4d62102d" class=""><code>AirdropFlashLoanReceiver.sol</code><strong> </strong>is<strong> </strong>designed for letting NFT depositors receive their deposited NFT’s airdrops. It can handle multiple situations, such as, claim airdrop ERC20 token, claim airdrop ERC721 NFT, or ERC1155. </p><p id="7ac89f97-5634-4eef-9f9c-4b013c822621" class="">Function <code>executeOperation()</code>main logic is the following:</p><ol type="1" id="da01b976-4b9f-4d00-9396-874949d90430" class="numbered-list" start="1"><li>allow the operator to transfer borrowed NFTs back to BNFT contracts</li></ol><ol type="1" id="462c8870-8a92-4b58-8c6f-72235dbf60b2" class="numbered-list" start="2"><li>call project airdrop contract</li></ol><ol type="1" id="2652ddb7-b740-40be-9129-7d43a2eb0740" class="numbered-list" start="3"><li>transfer airdrop tokens to the borrower</li></ol><p id="25515e0c-f531-4a9c-b26d-af57a1c724f3" class="">However, in STEP 3:</p><pre id="6ecb5122-50a0-45af-aa13-b3e88276839a" class="code"><code>else if (vars.airdropTokenTypes[typeIndex] == 2) {
  // ERC721
  vars.airdropBalance = IERC721(vars.airdropTokenAddresses[typeIndex]).balanceOf(address(this));
  for (uint256 i = 0; i &lt; vars.airdropBalance; i++) {
    vars.airdropTokenId = IERC721Enumerable(vars.airdropTokenAddresses[typeIndex]).tokenOfOwnerByIndex(
      address(this),
      0
    );
    IERC721Enumerable(vars.airdropTokenAddresses[typeIndex]).safeTransferFrom(
      address(this),
      initiator,
      vars.airdropTokenId
    );
  }
}</code></pre><p id="6b3f3a49-40f8-42cb-9d01-27f09eb54812" class="">The <strong>enumeration extension </strong>is <strong>OPTIONAL</strong> for ERC-721 smart contracts (see “caveats”, below). This allows your contract to publish its full list of NFTs and make them discoverable.  <a href="https://eips.ethereum.org/EIPS/eip-721"><strong>[Reference EIP-721]</strong></a></p><pre id="c347d756-478e-47d9-8558-68f8fb4ec4ae" class="code"><code>/// @title ERC-721 Non-Fungible Token Standard, optional enumeration extension
/// @dev See https://eips.ethereum.org/EIPS/eip-721
///  Note: the ERC-165 identifier for this interface is 0x780e9d63.
interface ERC721Enumerable /* is ERC721 */ {
    /// @notice Count NFTs tracked by this contract
    /// @return A count of valid NFTs tracked by this contract, where each one of
    ///  them has an assigned and queryable owner not equal to the zero address
    function totalSupply() external view returns (uint256);

    /// @notice Enumerate valid NFTs
    /// @dev Throws if `_index` &gt;= `totalSupply()`.
    /// @param _index A counter less than `totalSupply()`
    /// @return The token identifier for the `_index`th NFT,
    ///  (sort order not specified)
    function tokenByIndex(uint256 _index) external view returns (uint256);

    /// @notice Enumerate NFTs assigned to an owner
    /// @dev Throws if `_index` &gt;= `balanceOf(_owner)` or if
    ///  `_owner` is the zero address, representing invalid NFTs.
    /// @param _owner An address where we are interested in NFTs owned by them
    /// @param _index A counter less than `balanceOf(_owner)`
    /// @return The token identifier for the `_index`th NFT assigned to `_owner`,
    ///   (sort order not specified)
    function tokenOfOwnerByIndex(address _owner, uint256 _index) external view returns (uint256);
}</code></pre><p id="e909d5a4-d421-4832-a182-56e868b0fcf5" class="">This function call will fail when interacting with airdrop tokens that do not support this method.</p></details></li></ul><ul id="c0c9b632-514d-4399-91e5-1ccd57d1471f" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="42eeeef4-b95e-4a50-8aba-a5f9a9194585" class="">As stated in the above <strong>[Description]</strong></p><p id="34beb5a4-8bc1-41ac-b65e-380c80d0723a" class="">The exploit will happen when the airdrop is not ERC721 Enumerable, then this function call will fail when interacting with airdrop tokens that do not support the <code>tokenOfOwnerByIndex</code> method.</p></details></li></ul><ul id="d9c9795a-cc95-4085-8e5c-9f91bddbf467" class="toggle"><li><details open=""><summary><strong>Recommendation</strong></summary><ul id="3ad54110-da44-4095-ae7f-e402984d6d02" class="bulleted-list"><li style="list-style-type:disc">In the short term, the team needs to be careful when supporting new airdrop ERC721 tokens. The token must support <code>ERC721Enumerable</code>.</li></ul><ul id="79853468-b244-4f00-a07d-4777fd9b06a8" class="bulleted-list"><li style="list-style-type:disc">In the long term, we suggest modifying the function and only using methods from standard ERC721, which will greatly improve the compatibility of the contract.</li></ul></details></li></ul><ul id="94cd177d-888b-4e66-ab95-efd8d35399c3" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="cb4bafab-5d86-4437-bc89-fc2848aca63a" class=""><strong>Resolved. </strong>Fixed at commit <a href="https://github.com/BoundNFT/boundnft-protocol/tree/6f2a316faf05bc17ac4c19438a22091424766deb">6f2a316faf05bc17ac4c19438a22091424766deb</a>
 and has already been tested in the latest Doodles airdrop. The BendDAO team will pay extra attention when adding support for new NFT assets.</p></details></li></ul></li></ol></div><h3 id="338b9c52-7343-442a-b784-634fa7e950a5" class=""><details open=""><summary><mark class="highlight-blue">Informational</mark></summary></details></h3><div class="indented"><ol type="1" id="27d0cb42-f258-4b77-93d7-80ef1b677ac5" class="numbered-list" start="1"><li><strong>Move </strong><strong><code>batchBorrow() </code></strong><strong>and </strong><strong><code>batchRepay() </code></strong><strong>functions to periphery/helper contracts. (</strong><strong><code>LendPool.sol</code></strong><strong>, </strong><strong><code>PunkGateway.sol</code></strong><strong>, </strong><strong><code>WETHGateway.sol</code></strong><strong>)</strong><table id="d7914abc-3fa1-45cb-9724-aeef84577bfd" class="simple-table"><tbody><tr id="34aa2e55-5e89-4a0c-8280-88918a7fad52"><th id="okEA" class="block-color-blue_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-blue_background" style="width:528px"><mark class="highlight-blue"><strong>Informational</strong></mark></td></tr><tr id="3c177655-2a9d-470e-961b-408246360dcc"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px"><a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/LendPool.sol">contracts/protocol/LendPool.sol  </a>                                                 <a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/PunkGateway.sol">contracts/protocol/PunkGateway.sol    </a>                                               <a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/WETHGateway.sol">contracts/protocol/WETHGateway.sol</a></td></tr><tr id="53eb5a36-e242-47a8-95cd-2c3a56710f7c"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Acknowledged</strong></td></tr></tbody></table><ul id="2e181161-febc-41d4-8059-829bb280a6a7" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="a7717b8c-7afa-45c0-95d6-09f1cfe50add" class="">Current contract design integrated <code>batchBorrow()</code> and <code>batchRepay()</code> which enables multiple borrow/repays in a single function call. </p><p id="0cac74c3-1670-4830-b5ed-5c53d29cc11f" class="">These two functions are essentially multicall to the original <code>borrow </code>and <code>repay</code> function. Calls to external functions were made inside the loops, which might increase the attack surface of the contract. Most projects do not integrate these two function calls into their core smart contract due to higher contract risks.</p><p id="0f7be74e-c6a9-44bb-94be-583757f42b4e" class="">We suggest to move <code>batchBorrow()</code> and <code>batchRepay()</code> to a periphery/helper contracts.</p></details></li></ul><ul id="8fa36dce-c7ca-4d31-ad47-6f5a8f5c4d93" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="48201b5a-8add-4ce7-8310-5693dabf6911" class="">N/A</p></details></li></ul><ul id="a4e68151-f794-49d2-a4a1-9a3419203aa1" class="toggle"><li><details open=""><summary><strong>Recommendations</strong></summary><p id="8eb0afc9-7a1e-4622-9a28-4033a49c0ae9" class="">We suggest keeping the main contracts simple and elegant, only with the necessary functionalities. Less code, fewer attack surfaces. Helper functions like batch functions can be moved to a periphery contract/helper contract and done by a multicall to the function of the main contract. Those periphery contracts can easily be replaced without updating/changing the main contract if any vulnerabilities/issues are found in those helper functions.</p></details></li></ul><ul id="eaea06b9-8ddc-498e-a716-e056903f3057" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="6487bccd-5f18-4376-930c-80725f5e00a1" class=""><strong>Acknowledged. </strong>BendDAO decides to keep this batch feature in the future version of deployments.</p></details></li></ul><p id="fe9a67dc-18a2-44ce-ba43-7d5712ebfd9d" class="">
</p></li></ol><ol type="1" id="b4f4dcd1-5b26-4bdf-9d79-84db31c13ebb" class="numbered-list" start="2"><li><strong>Caution when adding new reserve assets</strong><table id="a64fbf37-d1d2-4174-a0a0-18d61a5b39d3" class="simple-table"><tbody><tr id="194ad47c-f258-4440-be80-3142021312f1"><th id="okEA" class="block-color-blue_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-blue_background" style="width:528px"><mark class="highlight-blue"><strong>Informational</strong></mark></td></tr><tr id="f97c455a-6ad9-4f21-b829-14d1195dd690"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px">N/A</td></tr><tr id="09b41379-1ee7-4aa6-91cb-d5398447d64a"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Acknowledged</strong></td></tr></tbody></table><ul id="907c39e9-e53a-481d-b29c-3a8fd0d9ba00" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="0c31ed64-beac-4357-b4e7-580a24714ace" class="">The current BendDAO Protocol only uses ETH as the reserve asset. Although, we know the BendDAO team has no plan of expanding the reserve assets list. It is still worth mentioning and informing BendDAO governance voters that adding new reserve assets may bring risks. </p><p id="22dc04a8-2946-4b15-8edf-a4edc4527234" class="">Tokens with before and after transfer hooks and tokens with double/multiple entry points bring more security risk. Be cautious when adding new tokens as reserve assets.</p></details></li></ul><ul id="f5fe1a68-1b0e-49f4-987f-3377c58b3835" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="8cc9a178-2285-4509-bd88-3f5253982a6b" class="">N/A</p></details></li></ul><ul id="362fca63-fcfa-4ef0-a437-117c9b7b786f" class="toggle"><li><details open=""><summary><strong>Recommendations</strong></summary><p id="4c3b0c2f-29fd-4231-b43c-4171db80fc11" class="">Be cautious when adding new tokens as reserve assets.</p></details></li></ul><ul id="c4b6a785-7547-4b7d-b291-7f4adc6132f6" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="07c60b85-c68f-491f-b31c-f16a94b4a2b7" class=""><strong>Acknowledged. </strong></p></details></li></ul><p id="e279aa3b-bb81-49d1-a8d3-0c44a0d7c003" class="">
</p></li></ol><p id="88ec1ade-d42e-4c75-ab1a-a6896f2971c9" class=""> 3. <strong>Function </strong><strong><code>removeAsset()</code></strong><strong> code optimization by Using </strong><strong><code>enumerate mapping</code></strong><div class="indented"><table id="006211d1-b6ac-4231-adb2-9ca0395106d6" class="simple-table"><tbody><tr id="27065189-b6c8-4281-a156-75cda174d197"><th id="okEA" class="block-color-blue_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-blue_background" style="width:528px"><mark class="highlight-blue"><strong>Informational</strong></mark></td></tr><tr id="5adac76d-461b-4dad-ada2-8bd9b2953312"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px"><a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/NFTOracle.sol">contracts/protocol/NFTOracle.sol</a></td></tr><tr id="fc61aa05-39b7-4100-b9ea-915dcdb147b3"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Acknowledged</strong></td></tr></tbody></table><ul id="2affa396-0087-4758-8e6b-ddefcf0a1f18" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="7d10ac3b-45df-410f-ab7d-1df3717aec1c" class="">Function <code>removeAsset()</code> in <code>NFTOracle.sol</code> are not optimized.</p><p id="9c617063-101a-4d5b-867a-e02ade45405d" class=""><code>removeAsset()</code> function is designed for removing unused or delist NFT addresses from the asset list. Inside the function, it uses a for loop to iterate through the entire list of the oracle asset and delete the target one. Similar functionality can be optimized by using iterative mapping technics.</p><p id="b591a9f7-d7a8-4c2f-bb0a-b718181604f9" class=""><a href="https://www.notion.so/BendDAO-Audit-Report-cf35568b43144e14a2abeb3d48f0ea2c">[checkout Recommendations for a sample improved code]</a></p><p id="31978cc5-4b75-4733-bbf6-6018afaaefcc" class="">Generally speaking, it is a better practice to keep the complexity within <code>O(1)</code>
 for the contracts deployed on the Ethereum mainnet. </p></details></li></ul><ul id="42ccdd7e-0bae-4d88-9803-8d6d25ba4c89" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="a5db3610-c1bd-4d3d-8695-74bd8dad3ae0" class="">N/A</p></details></li></ul><ul id="b85b3ee9-30a9-48e9-9a97-2337f9a9a5fe" class="toggle"><li><details open=""><summary><strong>Recommendations</strong></summary><p id="c8497ef3-9200-482d-99ae-5a3d73417567" class="">Here is the improved logic:</p><ol type="1" id="3876a3df-0620-4f5e-b4c5-0f834061c03f" class="numbered-list" start="1"><li>when <code>addNFT()</code>, save the NFT address to the array and record its index</li></ol><ol type="1" id="f65694d0-0685-41e9-9690-48587acfae3c" class="numbered-list" start="2"><li>when <code>removeNFT()</code>, copy the address of the last element to the target removed NFT index and then pop the last one.</li></ol><p id="eab1d59c-5b3b-47aa-93cd-d65c5389fd8f" class=""><strong>checking the below </strong><code><strong>enumerate mapping</strong></code><strong> example:</strong></p><pre id="916632ca-fcf5-40e0-b911-aab06379ba9e" class="code"><code>address[] public activeNFTs;
mapping(address =&gt; uint256) public indexOfNFT;

function addNFT(address nftAddress) public {
    require(nftAddress != address(0), &quot;AO: nftAddress is zero address&quot;);
    require(indexOfNFT[nftAddress] == 0, &quot;AO: already existed&quot;);
    activeNFTs.push(nftAddress);
    indexOfNFT[nftAddress] = activeNFTs.length;
}

function removeNFT(address nftAddress) public {
    require(nftAddress != address(0), &quot;AO: nftAddress is zero address&quot;);
    uint256 valueIndex = indexOfNFT[nftAddress];
    require(valueIndex != 0, &quot;AO: does not existed&quot;);
    uint256 toDeteleIndex = indexOfNFT[nftAddress] - 1;
    uint256 lastIndex = activeNFTs.length - 1;

    if (lastIndex != toDeteleIndex) {
        address lastValue = activeNFTs[lastIndex];
        activeNFTs[toDeteleIndex] = lastValue;
        indexOfNFT[lastValue] = valueIndex;
    }

    activeNFTs.pop();
    detele indexOfNFT[nftAddress];
}</code></pre></details></li></ul><ul id="3c4f189a-769a-4770-9a29-8bf3aea74393" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="b5b918e3-720d-420d-a8a8-b37b230a908f" class=""><strong>Acknowledged. </strong>This operation is rarely executed and only executed by admin, not users, Hence it’s not urgent for the BendDAO team to update the contract code for this suggestion.</p></details></li></ul><p id="48cb2840-e399-4924-bc89-124ccaa46991" class="">
</p></div></p><p id="f94c17b7-c9f7-4902-943a-4516aa35040c" class=""> 4. <strong>Function</strong><strong><code>setAssetData() </code></strong><strong>variable incrementation</strong><div class="indented"><table id="18510fcd-b314-4da8-943d-85eda8b58480" class="simple-table"><tbody><tr id="8ef4b414-1aa8-457b-804b-1be9ea052475"><th id="okEA" class="block-color-blue_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-blue_background" style="width:528px"><mark class="highlight-blue"><strong>Informational</strong></mark></td></tr><tr id="042e2e64-48a7-42e8-b156-64650c630376"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px"><a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/NFTOracle.sol">contracts/protocol/NFTOracle.sol</a></td></tr><tr id="aebfee6c-2441-429e-9d1c-9c67fc72f467"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Resolved </strong>in commit <a href="https://github.com/BendDAO/bend-lending-protocol/commit/152921a01c9ecf7815f7f6d13ab6f2a3623eb505">152921a01c9ecf7815f7f6d13ab6f2a3623eb505</a></td></tr></tbody></table><ul id="7cf7f9cd-107e-421c-812a-893b5defe23c" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="7f7ccc47-34a6-4256-80bb-d73c7b71c056" class=""><code>_roundId</code> in <code>setAssetData()</code> should be self-incremented instead of treated as an input by the admin.</p><p id="ddf5d746-22a8-4ee6-adcc-62e36e7c4526" class="">Function <code>setAssetData()</code> in <code>NFTOracle.sol</code> has been designed to only allow the admin of the protocol to upload the current floor price of the target NFT. There are 4 inputs of this function:</p><ol type="1" id="bb80a462-a4d9-487a-abac-4d76b7a1b2ed" class="numbered-list" start="1"><li><code>_nftContract</code> - contract address of the NFT in the asset list</li></ol><ol type="1" id="9ee3cea3-3ad8-4151-b07a-f3ffbdc6b923" class="numbered-list" start="2"><li><code>_price</code> - NFT latest floor price</li></ol><ol type="1" id="0a7e9acb-4d27-45c9-9811-a8153daa1b01" class="numbered-list" start="3"><li>[optional] <code>_timestamp</code> - timestamp</li></ol><ol type="1" id="0d74d844-7edf-47a8-9c7f-3c3b935c39e7" class="numbered-list" start="4"><li><code>_roundId</code> - an index for labelling</li></ol><p id="a2936c6a-333a-44b6-983a-b6eaee9171f9" class=""><code>_roundId</code> is currently treated as an input. It would be better if there is an incrementation logic in <code>setAssetData() </code>to ensure the <code>_roundId </code>will not collide with the ones before.</p></details></li></ul><ul id="156876d0-d2b6-44fc-93f4-3c32c8574feb" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="684ee5ae-5761-4e5a-92c0-c877604d069a" class=""><code>_roundId</code> collision will not have a material effect, as <code>_roundId</code> is not used in any critical value calculation. However, having a <code>_roundId</code> collision might cause confusion in subsequent development work.</p></details></li></ul><ul id="5a03e89b-8645-4bd6-88ec-4cfe2d169d38" class="toggle"><li><details open=""><summary><strong>Recommendations</strong></summary><p id="e0b4ac9b-9c12-414c-9715-e523e91eafa2" class="">Add an incrementation logic inside the function to make sure the <code>_roundId</code> will never collide with the previous ones.</p><p id="d8dc34e0-1c89-4db2-be08-e4304e9d6b7e" class=""><strong>checking the below example:</strong></p><pre id="8778d4ce-75a2-4757-a324-626551d3c9a9" class="code"><code>function setAssetData(
    address _nftContract,
    uint256 _price,
    uint256 /*_timestamp*/
  ) external override onlyAdmin whenNotPaused(_nftContract) {
    requireKeyExisted(_nftContract, true);
    uint256 _timestamp = _blockTimestamp();
    require(_timestamp &gt; getLatestTimestamp(_nftContract), &quot;NFTOracle: incorrect timestamp&quot;);
    require(_price &gt; 0, &quot;NFTOracle: price can not be 0&quot;);
    bool dataValidity = checkValidityOfPrice(_nftContract, _price, _timestamp);
    require(dataValidity, &quot;NFTOracle: invalid price data&quot;);
    
    // NOTE: read latest _roundID and increment it by 1
    uint256 newRoundId = getLatestRoundId(_nftContract) + 1;
    // NOTE: assign the newRoundID to data
    NFTPriceData memory data = NFTPriceData({price: _price, timestamp: _timestamp, roundId: newRoundId});
    nftPriceFeedMap[_nftContract].nftPriceData.push(data);

    emit SetAssetData(_nftContract, _price, _timestamp, _roundId);
  }</code></pre></details></li></ul><ul id="e09f05e3-0ba2-4453-a83e-fc28653a91a6" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="aa5993f7-b4a0-4048-b97d-e99440e65356" class="">Resolved in commit <a href="https://github.com/BendDAO/bend-lending-protocol/commit/152921a01c9ecf7815f7f6d13ab6f2a3623eb505">152921a01c9ecf7815f7f6d13ab6f2a3623eb505</a>.</p></details></li></ul></div></p><p id="008ab71f-1250-4260-b65d-4faa95386a70" class="">
</p><p id="428adeca-1970-4a26-abeb-24f6164372dd" class=""> 5. <strong>Suggest integrating Chainlink Any API</strong><div class="indented"><table id="55bfb24a-fada-4574-9996-4436b5cf20ae" class="simple-table"><tbody><tr id="066871ac-095a-4cde-ae76-311d62ea30c5"><th id="okEA" class="block-color-blue_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-blue_background" style="width:528px"><mark class="highlight-blue"><strong>Informational</strong></mark></td></tr><tr id="a92253e5-85fe-4c4f-8810-0e75b64d13c7"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px"><a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/NFTOracle.sol">contracts/protocol/NFTOracle.sol</a></td></tr><tr id="f27c93c4-c8c5-4fae-9d76-89020c1e6d9a"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Acknowledged</strong></td></tr></tbody></table><ul id="8d29c805-d8d7-46f1-945c-a4ee51a90347" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="2a9ce59d-ffe0-44ff-8749-77918a4afe90" class="">To improve the general security and overall decentralization, we suggest the BendDAO team considered integrating with Chainlink Any API.</p><p id="e67d0d22-2094-4ee0-880b-d1710a8007c0" class="">The BendDAO protocol uses OpenSea &amp; LooksRare as the data source. Currently, all data queries &amp; sorting are managed off-chain. Centralized servers are querying data and pushing data to the on-chain smart contract.</p><p id="0e9d597c-634d-45ca-b456-ab10c411c8c8" class="">Bringing data queries &amp; sorting on-chain can improve the transparency and reliability of the data source.</p></details></li></ul><ul id="3a37b85f-916d-4c7a-9aca-45724c1a3017" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="48186891-a342-461f-8d28-c436fcd5d5cc" class="">N/A</p></details></li></ul><ul id="ec053354-f7d8-43be-9caf-5f163bb98d73" class="toggle"><li><details open=""><summary><strong>Recommendations</strong></summary><p id="7a42e914-2a04-4ce8-9ae2-684d3d71dc3e" class="">Integrating with Chainlink product Any API. Chainlink enables smart contracts to access any external data sources through its decentralized oracle network.</p></details></li></ul><ul id="627fc3a9-dc16-4220-a124-6d12d59450eb" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="c4cb9662-35be-4ea7-b718-80923c2cb432" class=""><strong>Acknowledged. </strong>The BendDAO team is considering this suggestion in future development.</p><p id="35ef4526-6408-4109-bdba-a0989ff681b1" class="">
</p></details></li></ul></div></p><p id="69418ae9-64c1-41fe-a7a3-23c20aa2b6eb" class=""> 6. <strong>Comment mistake</strong><div class="indented"><table id="7d3f597d-a85f-4cd0-ab74-6b8e892b0392" class="simple-table"><tbody><tr id="90acbca0-8d9f-4885-a308-e8b2ce5211a2"><th id="okEA" class="block-color-blue_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-blue_background" style="width:528px"><mark class="highlight-blue"><strong>Informational</strong></mark></td></tr><tr id="e80dfd45-5ac8-49f7-b034-aa48cde1abfa"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px">contracts/protocol/NFTOracle.sol: <a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/NFTOracle.sol#L178">L178</a></td></tr><tr id="a01d5535-d4f2-4588-bfb0-122f47add4a3"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Resolved</strong></td></tr></tbody></table><ul id="0cd5427f-30a5-4960-acfa-c00e75f06f3e" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="db8e5837-8147-4aea-97cd-5567a93ce948" class="">Comment mistake in the <code>NFTOracle.sol</code>.</p><p id="f03d4cd5-5296-4afd-b6e6-557bd4034d9a" class=""><code>_interval </code>variable no longer existed in the contract, as the latest code is using <code>twapInterval</code>.</p></details></li></ul><ul id="77307465-13a9-4fe2-8a72-209c0033ae8c" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="98328086-b85f-466b-a247-5326ac514635" class="">N/A</p></details></li></ul><ul id="e5bf2eb7-2ab2-4d3e-b3e1-4ae2c1a10a08" class="toggle"><li><details open=""><summary><strong>Recommendations</strong></summary><p id="c5e54835-3e57-4ce7-b59e-a837df911f0c" class="">change <code>_interval </code>in the comment to <code>twapInterval</code></p></details></li></ul><ul id="b034d463-29a5-40d2-a451-6e6caabde6d6" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="f67d0a22-d906-4464-bc30-0e8698ad2998" class=""><strong>Resolved.</strong></p><p id="9f5ed18e-59e3-44ad-be51-ec24eb8ecbf8" class="">
</p></details></li></ul></div></p><p id="d5339804-5832-4b78-b554-0ad53151a937" class=""> 7. <strong><code>NFTOracle.sol</code></strong><strong>: </strong><strong><code>getAssetPrice() </code></strong><strong>returns TWAP price only.</strong><div class="indented"><table id="74ed08a0-872a-4427-846d-f5f8bd7ea91e" class="simple-table"><tbody><tr id="4ccd76da-6d61-4f2a-b9c1-50ce4d2fa2b6"><th id="okEA" class="block-color-blue_background simple-table-header" style="width:80px">Severity</th><td id="y}lo" class="block-color-blue_background" style="width:528px"><mark class="highlight-blue"><strong>Informational</strong></mark></td></tr><tr id="a08437b6-7afa-44bb-bc8b-b0cca612a9f1"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Source</th><td id="y}lo" class="" style="width:528px"><a href="https://github.com/BendDAO/bend-lending-protocol/blob/087c284fda18e9d7fd3a07de384a2245d5eab6ea/contracts/protocol/NFTOracle.sol">contracts/protocol/NFTOracle.sol</a></td></tr><tr id="afc236fe-00a9-4f8a-aede-d0ef5886d938"><th id="okEA" class="simple-table-header-color simple-table-header" style="width:80px">Status</th><td id="y}lo" class="" style="width:528px"><strong>Acknowledged</strong></td></tr></tbody></table><ul id="26c3f28c-8fdf-457a-ba14-03dc888ba8db" class="toggle"><li><details open=""><summary><strong>Description</strong></summary><p id="8eb2913c-b73f-451a-bbdf-5d358b4ddfde" class="">Function <code>getAssetPrice()</code> only returns TWAP price of the NFT asset.</p><p id="2529990c-4797-4283-a07d-52533103e5ad" class="">In branch <code>Oracle/roundid</code>’s commit, the updated <code>getAssetPrice()</code> does not return the raw price data. </p></details></li></ul><ul id="d7d9350e-b3e9-4056-8cdf-5c6e17e3c3d1" class="toggle"><li><details open=""><summary><strong>Exploit Scenario</strong></summary><p id="55ed32ee-0b66-4e2c-a87b-3493f6f13c5c" class="">N/A</p></details></li></ul><ul id="97fb32ef-eb04-4563-bb32-4731da5a2e8b" class="toggle"><li><details open=""><summary><strong>Recommendations</strong></summary><p id="7179bae7-d6f2-42e8-b270-6620e47fb13a" class="">Consider returning a <code>(twapPrice, rawPrice) </code>tuple, or adding an extra <code>getAssetRawPrice() </code>function to fetch the raw price data.</p></details></li></ul><ul id="c1021c36-f881-4eff-a985-13c45d2cad5c" class="toggle"><li><details open=""><summary><strong>Results</strong></summary><p id="1d97b5ef-5223-44d1-a5ef-b303d365bd23" class=""><strong>Acknowledged. </strong>The BendDAO team decided to keep the original design.</p></details></li></ul></div></p></div></div><h2 id="142b159f-f21b-4548-9fa6-b5a155b00405" class=""><details open=""><summary>Access Control Analysis</summary></details></h2><div class="indented"><h3 id="4c7511eb-2863-482c-876d-51d61736f191" class=""><details open=""><summary>Lending Pool</summary></details></h3><div class="indented"><p id="b95cb7c6-ed51-4cf8-965a-ab64ab046ae9" class="">There are two major privileged roles for the lending pool:</p><ul id="10e8ce4d-35de-47f5-9077-b1debc324f7f" class="bulleted-list"><li style="list-style-type:disc">poolAdmin:<ul id="cb2db535-7269-468e-a335-eb020f979d3a" class="bulleted-list"><li style="list-style-type:circle">configure the pool including upgrading contracts, setting essential parameters, and adding/removing reserve assets and NFT assets.</li></ul></li></ul><ul id="c263b33c-8995-4e46-a994-c6ac09a2fc67" class="bulleted-list"><li style="list-style-type:disc">emergencyAdmin:<ul id="eef63eeb-8676-4624-8464-59db38d26ba1" class="bulleted-list"><li style="list-style-type:circle">pause and unpause the lending pool.</li></ul></li></ul></div><h3 id="ec2d881e-fcad-409f-b2fc-99368b227ffd" class=""><details open=""><summary>NFT Oracle</summary></details></h3><div class="indented"><p id="12d785e1-3c2b-4314-a15b-ca18c3420051" class="">There are two types of admin roles in the NFT Oracle:</p><ul id="159ce0bb-42cc-4202-af65-7950db575999" class="bulleted-list"><li style="list-style-type:disc"><code>_owner</code>: a multi-sig wallet controlled by the BendDAO dev team<p id="3c2d1bd2-bc04-47bf-84c7-0b697edcf2f0" class="">1. <code>setPriceFeedAdmin()</code><div class="indented"><p id="10198768-9795-431a-8a39-a8d13146f459" class="">set a new address for an admin account in the smart contracts.</p></div></p><p id="bfe49fdd-d6bd-41c3-b87d-90732972f25f" class="">2. <code>setAssets()</code><div class="indented"><p id="4b61c241-5ce9-4d22-baac-6d286db7b6ff" class="">add a list of addresses of NFT to the oracle</p></div></p><p id="a213061a-2786-41eb-b602-d8f4abe75972" class="">3. <code>addAsset()</code><div class="indented"><p id="2dc4fee6-3e20-4662-866d-24175ee42f0a" class="">add a single address of NFT to the oracle</p></div></p><p id="cd9e352c-134e-4c3a-96cf-0cd814342dab" class="">4. <code>removeAsset()</code><div class="indented"><p id="4624fb22-6681-44a8-9f03-75f884e03da3" class="">remove a single address of NFT from the oracle</p></div></p><p id="0dee1f4a-465e-4e05-9300-4c66295d917f" class="">5. <code>setDataValidityParameters()</code><div class="indented"><p id="0e5ea94d-28dd-45e6-9b30-8d4dd8072465" class="">set a list of validity checking &amp; security-related parameters (e.g maximum price deviation, the shortest time interval for the price update … )</p></div></p><p id="064b8513-269c-439a-968d-9f59b03d1d6e" class="">6. <code>setPause()</code><div class="indented"><p id="3089262b-812a-496c-94e3-f64c1dc7b044" class="">an emergency brake for a specific NFT of the oracle</p></div></p></li></ul><ul id="a3fab3fa-79ba-4c3e-8a77-f03e1770d121" class="bulleted-list"><li style="list-style-type:disc"><code>_admin</code>: a wallet imported to a cloud server to feed price on-chain<p id="5f9e2377-5722-4d72-902d-54734bb48a80" class="">1. <code>setAssetData()</code><div class="indented"><p id="ac421087-5252-4768-a824-fed9fb2b0dcf" class="">set the price of a specific NFT collection.</p></div></p></li></ul></div></div><h2 id="c9e70809-9624-43ac-bbc9-71ba185117c5" class=""><details open=""><summary>Off-Chain OpSec</summary></details></h2><div class="indented"><p id="119c855e-fd8d-43e9-9d8f-3513a157da12" class="">BendDAO protocol off-chain components are majorly in the following components:</p><ul id="5b82b4f5-7d5c-4cee-92e6-f2a78d78cd38" class="bulleted-list"><li style="list-style-type:disc">Lending Protocol</li></ul><ul id="49b5d713-69f6-4ca3-a0a5-b6e95d73987d" class="bulleted-list"><li style="list-style-type:disc">NFT Oracle</li></ul><ul id="2fd2de2a-8d98-4c07-9d23-3facd8a2ccb5" class="bulleted-list"><li style="list-style-type:disc">Admin Addresses</li></ul><h3 id="adf64b71-dc58-4706-bce5-9b1593bf56b1" class=""><details open=""><summary>Lending Protocol</summary></details></h3><div class="indented"><p id="67bd529d-28e4-427c-a4b9-32c8b57785ad" class=""><strong>There are two major privileged roles for the lending pool:</strong></p><ul id="961f861e-5638-4698-bc82-0a7afc849b44" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-orange_background">poolAdmin</mark>:<ul id="072790f4-c65a-4e1d-bacb-d2d459c6bcd4" class="bulleted-list"><li style="list-style-type:circle">configure the pool including upgrading contracts, setting essential parameters, and adding/removing reserve assets and NFT assets.</li></ul></li></ul><ul id="fdf12d5a-b69d-4f05-9055-7ff5e6aa20c5" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-orange_background">emergencyAdmin</mark>:<ul id="47631ad2-5077-418c-9416-9f160d938def" class="bulleted-list"><li style="list-style-type:circle">pause and unpause the lending pool.</li></ul></li></ul></div><h3 id="552fd7e3-14d8-4835-83d4-6cc239816ec0" class=""><details open=""><summary>NFT Oracle</summary></details></h3><div class="indented"><p id="c243596a-2f31-4cdc-a9ba-fc28b6081a2b" class="">There are two types of admin roles in the NFT Oracle:</p><ul id="8a211e7b-4064-4b68-99c8-772ae21e298d" class="bulleted-list"><li style="list-style-type:disc"><code>_owner</code>: a multi-sig wallet controlled by the BendDAO dev team<p id="d7ba12de-a9a2-4e8c-9407-43fea2cd5413" class="">1. <code>setPriceFeedAdmin()</code><div class="indented"><p id="c5860fc8-2001-43aa-ad1f-82f428553481" class="">set a new address for an admin account in the smart contracts.</p></div></p><p id="42370424-9456-4802-ad6e-71f65b45fc1f" class="">2. <code>setAssets()</code><div class="indented"><p id="9ef8bb3b-d8b9-42f7-8073-cf8038545137" class="">add a list of addresses of NFT to the oracle</p></div></p><p id="1b9419c4-fa13-4a6e-ad4a-4b7b58056ace" class="">3. <code>addAsset()</code><div class="indented"><p id="2e91fe3d-72bb-4cd4-a1b8-268aeb4569a1" class="">add a single address of NFT to the oracle</p></div></p><p id="90fd5ca7-9bec-47df-aa46-4a59ec094d36" class="">4. <code>removeAsset()</code><div class="indented"><p id="777a2405-c648-4b2d-82a8-95f6abe439e7" class="">remove a single address of NFT from the oracle</p></div></p><p id="908353b6-ad36-47b4-8f29-868e1c77f363" class="">5. <code>setDataValidityParameters()</code><div class="indented"><p id="01e5f7ca-6b4f-4910-819b-177a7c96ea12" class="">set a list of validity checking &amp; security-related parameters (e.g maximum price deviation, the shortest time interval for the price update … )</p></div></p><p id="3b7e8515-29f4-4e1f-8676-6131a195a272" class="">6. <code>setPause()</code><div class="indented"><p id="cc1e2088-9d41-46ea-8c56-d9ad72b1dc01" class="">an emergency brake for a specific NFT of the oracle</p></div></p></li></ul><p id="3f8278f1-27be-4f9a-b7b7-9ab88ab4ec5e" class="">
</p><ul id="a3843cfe-b384-489c-8afd-ac2e9fe73747" class="bulleted-list"><li style="list-style-type:disc"><code>_admin</code>: a wallet imported to the cloud server to feed price on-chain<p id="e2f5fa40-f75f-47e2-a59d-43f29c04a999" class="">1. <code>setAssetData()</code><div class="indented"><p id="6255c490-111a-4958-b230-b13d7029671d" class="">set the price of a specific NFT collection.</p></div></p><p id="5d44e879-606c-429e-8f07-30692d738e51" class="">
</p></li></ul><p id="13b37147-f001-48db-8eb8-5784e6c5f962" class="">The admin addresses and private keys are managed and stored on a cloud server, and multiple measures were taken to enhance the security of the price oracle. There are two sets of oracle nodes with independent private keys. The duplicate node design, combined with an on-chain price filter, is to mitigate the price manipulation attack in case one of the private keys is leaked. In addition, the IP addresses of these oracle nodes are hidden to protect the nodes from DDOS attacks.</p><p id="b89ade88-ea22-490d-85d3-b6e40d944dbb" class=""><div class="indented"><figure id="26a11369-bcc6-4aba-8dee-46111a0f28ed" class="image"><a href="BendDAO%20Audit%20Report%203152caf630f94c11a03a49bf6d6c3a97/Untitled%202.png"><img style="width:2050px" src="BendDAO%20Audit%20Report%203152caf630f94c11a03a49bf6d6c3a97/Untitled%202.png"/></a><figcaption>                                                   <em><strong>End-to-end encryption is enabled</strong></em></figcaption></figure></div></p><p id="55b6d7ab-8e3c-44bf-8705-81a4edf61ac7" class="">In addition, the BendDAO team has acknowledged the risks and would actively monitor the oracle addresses. The team also manages a multi-sig wallet as the owner to replace the current EOA admin account of the NFT Oracle smart contract, if necessary.</p><p id="e343a1a2-70f0-4a75-8f19-081a4aac6374" class="">To minimize the room for price manipulation, there are various constraints for the prices fed to the oracle and the frequency of price updates (e.g price feeding granularity settings and filters for abnormal prices and prices with volatility higher than accepted).</p><p id="5aec1670-e878-4bd4-b7e5-fa2ef5f72152" class="">The operation of the BendDAO protocol is highly dependent on the NFT price oracle. To further enhance the stability and security of the protocol, discussions about NFT oracle design improvement were arranged between the BendDAO dev team and the Verilog Solutions audit team. Based on our discussion about the oracle structure and analysis of the historical data, we concluded that a time-weighted moving average (TWAP) floor price (<em>e.g.</em>, a 6h TWAP price can filter out abnormal floor price data) can be used as a valid market valuation.</p><figure id="5e949ced-8a93-44f0-ad92-d6ff5df707bc" class="image"><a href="BendDAO%20Audit%20Report%203152caf630f94c11a03a49bf6d6c3a97/Untitled%203.png"><img style="width:761px" src="BendDAO%20Audit%20Report%203152caf630f94c11a03a49bf6d6c3a97/Untitled%203.png"/></a><figcaption>                                        <strong><em>6h TWAP floor price compared with the raw floor price</em></strong></figcaption></figure><ul id="4e76e86a-edd5-4836-81d7-fb48aa44ec12" class="bulleted-list"><li style="list-style-type:disc">Blue Line represents the frequently fetched market raw floor price.</li></ul><ul id="a1d54875-df21-450d-a6d7-5233f6cb9cec" class="bulleted-list"><li style="list-style-type:disc">Red Line represents the 6h TWAP floor price</li></ul></div><h3 id="45649fb8-0374-4e04-a85a-945012a5f055" class=""><details open=""><summary><strong><strong>Securing Admin Addresses</strong></strong></summary></details></h3><div class="indented"><p id="7ba1bcc2-c8a4-4d81-b33e-6f670abddd99" class="">Lending Protocol, NFT Oracle, and BoundNFT have admin roles. The admin roles are secured via multi-sig and <code>TimelockController</code>mechanisms. </p><p id="6410f889-b5c1-43bf-979c-e6b01126d491" class="">The details of the multi-sig and <code>TimelockController</code>addresses can be found at <a href="https://docs.benddao.xyz/portal/risk/security-and-audits">BendDAO: Security and Audits Docs</a>.</p></div></div><h2 id="68648cff-cb6f-41c6-a5a2-4c9cf65b4cea" class=""><details open=""><summary>Appendix I: Severity Categories</summary></details></h2><div class="indented"><table id="d537dfb1-177a-4081-87a8-0659796bcbca" class="simple-table"><thead class="simple-table-header"><tr id="3480a373-5575-47cc-aa52-bd02bcddb851"><th id="kXVg" class="simple-table-header-color simple-table-header"><strong>Severity</strong></th><th id="anJe" class="simple-table-header-color simple-table-header" style="width:536px"><strong>Description</strong></th></tr></thead><tbody><tr id="04a8e55b-9af9-4098-8d73-fadbbc5755ec"><td id="kXVg" class=""><strong><mark class="highlight-red">High</mark></strong></td><td id="anJe" class="" style="width:536px">Issues that are highly exploitable security vulnerabilities. It may cause direct loss of funds / permanent freezing of funds. All high severity issues should be resolved.</td></tr><tr id="54677528-8324-4eef-a4df-e3d382f51f33"><td id="kXVg" class=""><strong><mark class="highlight-orange">Medium</mark></strong></td><td id="anJe" class="" style="width:536px">Issues that are only exploitable under some conditions or with some privileged access to the system. Users’ yields/rewards/information is at risk. All medium severity issues should be resolved unless there is a clear reason not to.</td></tr><tr id="bdaf57c8-2242-4119-adbf-c0a4df251bb2"><td id="kXVg" class=""><strong><mark class="highlight-teal">Low</mark></strong></td><td id="anJe" class="" style="width:536px">Issues that are low risk. Not fixing those issues will not result in the failure of the system. A fix on low severity issues is recommended but subject to the clients’ decisions.</td></tr><tr id="332bc91f-4756-46ac-a58b-17370175fe8e"><td id="kXVg" class=""><strong><mark class="highlight-blue">Informational</mark></strong></td><td id="anJe" class="" style="width:536px">Issues that pose no risk to the system and are related to the security best practices. Not fixing those issues will not result in the failure of the system. A fix on informational issues or adoption of those security best practices-related suggestions is recommended but subject to clients’ decision.</td></tr></tbody></table></div><h2 id="1fca1f6c-db85-4a54-961f-9f0bacc997dc" class=""><details open=""><summary>Appendix II: Status Categories</summary></details></h2><div class="indented"><table id="33b03593-1dc9-4d20-9dba-b1ee357d43d3" class="simple-table"><thead class="simple-table-header"><tr id="c95f8623-adcc-4274-a2da-d06527cd59f6"><th id="GLY]" class="simple-table-header-color simple-table-header"><strong>Status</strong></th><th id="f@^l" class="simple-table-header-color simple-table-header" style="width:518px"><strong>Description</strong></th></tr></thead><tbody><tr id="41825c5e-ed41-442d-9b8b-79d633bed29a"><td id="GLY]" class=""><strong>Unresolved</strong></td><td id="f@^l" class="" style="width:518px">The issue is not acknowledged and not resolved.</td></tr><tr id="929bc523-0668-4cdb-8492-302bd44fe3de"><td id="GLY]" class=""><strong>Partially Resolved</strong></td><td id="f@^l" class="" style="width:518px">The issue has been partially resolved</td></tr><tr id="25fbabe8-e71d-4362-a919-83b86da1aa8c"><td id="GLY]" class=""><strong>Acknowledged</strong></td><td id="f@^l" class="" style="width:518px">The Finding / Suggestion is acknowledged but not fixed / not implemented.</td></tr><tr id="469d472e-7f44-4873-b1a2-5ad981138d20"><td id="GLY]" class=""><strong>Resolved</strong></td><td id="f@^l" class="" style="width:518px">The issue has been sufficiently resolved</td></tr></tbody></table></div><h2 id="52e27793-a0e0-40a8-a5ee-72e6e0f11975" class=""><details open=""><summary>Disclaimer</summary></details></h2><div class="indented"><p id="dba82418-ddba-47e5-a841-29a178a2104a" class="">Verilog Solutions receives compensation from one or more clients for performing the smart contract and auditing analysis contained in these reports. The report created is solely for Clients and published with their consent. As such, the scope of our audit is limited to a review of code, and only the code we note as being within the scope of our audit is detailed in this report. It is important to note that the Solidity code itself presents unique and unquantifiable risks since the Solidity language itself remains under current development and is subject to unknown risks and flaws. Our sole goal is to help reduce the attack vectors and the high level of variance associated with utilizing new and consistently changing technologies. Thus, Verilog Solutions in no way claims any guarantee of security or functionality of the technology we agree to analyze.</p><p id="88a662d8-60b0-4ba6-9770-18b1f0b1ea92" class="">In addition, Verilog Solutions reports do not provide any indication of the technologies proprietors, business, business model, or legal compliance. As such, reports do not provide investment advice and should not be used to make decisions about investment or involvement with any particular project. Verilog Solutions has the right to distribute the Report through other means, including via Verilog Solutions publications and other distributions. Verilog Solutions makes the reports available to parties other than the Clients (i.e., “third parties”) – on its website in hopes that it can help the blockchain ecosystem develop technical best practices in this rapidly evolving area of innovation.</p><p id="a40aba7f-fba7-4342-a787-85b4b5a5a26a" class="">
</p></div><p id="f61b0450-452b-4dd3-b18a-c860a71337db" class="">
</p></div></article></body></html>